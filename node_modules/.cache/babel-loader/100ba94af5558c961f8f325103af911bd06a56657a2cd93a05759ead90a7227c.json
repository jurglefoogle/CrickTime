{"ast":null,"code":"import _objectSpread from\"C:/Users/jurgl/HTMLProjects/CrickTime/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useMemo}from'react';import Card from'../ui/Card';import Button from'../ui/Button';import Input from'../ui/Input';import Select from'../ui/Select';import{dataService}from'../../utils/dataService';/**\r\n * Invoice Tab Component\r\n * Reference: www.context7.com for invoice generation patterns\r\n */import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const InvoiceTab=_ref=>{let{appData,updateAppData,invoiceContext,clearInvoiceContext}=_ref;const[selectedClient,setSelectedClient]=useState('');const[startDate,setStartDate]=useState('');const[endDate,setEndDate]=useState('');const[invoiceData,setInvoiceData]=useState(null);// holds draft or finalized invoice meta & all candidate line items\nconst[selectedIds,setSelectedIds]=useState(new Set());const[finalized,setFinalized]=useState(false);const[mode,setMode]=useState(invoiceContext!==null&&invoiceContext!==void 0&&invoiceContext.jobId?'job':'client');// 'client' | 'job'\nconst[selectedJobId,setSelectedJobId]=useState((invoiceContext===null||invoiceContext===void 0?void 0:invoiceContext.jobId)||'');const[closeJobOnFinalize,setCloseJobOnFinalize]=useState(false);// Get client options\nconst clientOptions=appData.clients.map(client=>({value:client.id,label:client.name}));// Generate draft invoice data (does NOT mark entries/charges invoiced yet)\nconst generateInvoice=()=>{if(!selectedClient||!startDate||!endDate){alert('Please select a client and date range');return;}if(mode==='job'&&!selectedJobId){alert('Select a job for Job mode');return;}const client=appData.clients.find(c=>c.id===selectedClient);if(!client){alert('Selected client not found');return;}const start=new Date(startDate);const end=new Date(endDate);end.setHours(23,59,59,999);// Include full end date\nif(start>end){alert('Start date must be before end date');return;}// Get entries for the client and date range\nconst clientEntries=appData.entries.filter(entry=>{if(!entry.end||entry.clientId!==selectedClient)return false;if(entry.invoiced)return false;// skip already invoiced\nif(mode==='job'&&entry.jobId!==selectedJobId)return false;const entryDate=new Date(entry.start);return entryDate>=start&&entryDate<=end;});// Get charges for client within date range\nconst clientCharges=(appData.charges||[]).filter(ch=>{if(ch.invoiced)return false;if(ch.clientId!==selectedClient)return false;if(mode==='job'&&ch.jobId!==selectedJobId)return false;const chDate=new Date(ch.createdAt);return chDate>=start&&chDate<=end;});if(clientEntries.length===0&&clientCharges.length===0){alert('No billable entries or charges found for the selected criteria');return;}// Create candidate line items (all initially selected)\nconst timeLineItems=clientEntries.map(entry=>{const taskName=entry.taskName||'Unknown Task';const duration=entry.end-entry.start;const hours=dataService.durationToHours(duration);const amount=hours*client.rate;return{id:entry.id,date:dataService.formatDate(entry.start),task:taskName,notes:entry.notes||'',hours:hours,rate:client.rate,amount:amount};});const chargeLineItems=clientCharges.map(ch=>({id:ch.id,kind:'charge',chargeType:ch.kind,date:dataService.formatDate(ch.createdAt),task:ch.description,notes:'',hours:0,rate:ch.unitPrice,quantity:ch.quantity,unitCost:ch.unitCost,amount:ch.amountCached}));const lineItems=[...timeLineItems,...chargeLineItems];const jobMeta=mode==='job'?(appData.jobs||[]).find(j=>j.id===selectedJobId):null;const invoice={client,dateRange:{start:dataService.formatDate(start),end:dataService.formatDate(end)},lineItems,job:jobMeta?{id:jobMeta.id,name:jobMeta.name}:null,generatedDate:dataService.formatDate(new Date()),invoiceNumber:\"INV-\".concat(Date.now())};setInvoiceData(invoice);setSelectedIds(new Set(lineItems.map(li=>li.id)));setFinalized(false);};// Toggle selection of a line item\nconst toggleLineItem=id=>{if(finalized)return;setSelectedIds(prev=>{const next=new Set(prev);if(next.has(id))next.delete(id);else next.add(id);return next;});};const selectAll=()=>{if(!invoiceData||finalized)return;setSelectedIds(new Set(invoiceData.lineItems.map(li=>li.id)));};const clearAll=()=>{if(finalized)return;setSelectedIds(new Set());};// Compute totals from selected items\nconst selectedLineItems=useMemo(()=>{if(!invoiceData)return[];return invoiceData.lineItems.filter(li=>selectedIds.has(li.id));},[invoiceData,selectedIds]);const computedTotals=useMemo(()=>{const hours=selectedLineItems.reduce((s,i)=>s+i.hours,0);const amount=selectedLineItems.reduce((s,i)=>s+i.amount,0);return{hours,amount};},[selectedLineItems]);// Finalize invoice: mark selected entries as invoiced & persist snapshot history\nconst finalizeInvoice=()=>{var _invoiceData$job;if(!invoiceData)return;if(selectedIds.size===0){alert('Select at least one line item to finalize the invoice.');return;}const updatedEntries=appData.entries.map(e=>selectedIds.has(e.id)?_objectSpread(_objectSpread({},e),{},{invoiced:true}):e);const updatedCharges=(appData.charges||[]).map(c=>selectedIds.has(c.id)?_objectSpread(_objectSpread({},c),{},{invoiced:true}):c);const snapshot={id:dataService.generateId(),invoiceNumber:invoiceData.invoiceNumber,clientId:invoiceData.client.id,jobId:((_invoiceData$job=invoiceData.job)===null||_invoiceData$job===void 0?void 0:_invoiceData$job.id)||null,dateRange:invoiceData.dateRange,generatedAt:Date.now(),lineItems:selectedLineItems.map(li=>({id:li.id,kind:li.kind||'time',chargeType:li.chargeType,date:li.date,task:li.task,notes:li.notes,hours:li.hours,rate:li.rate,quantity:li.quantity,unitCost:li.unitCost,amount:li.amount})),subtotal:computedTotals.amount,total:computedTotals.amount};let patch={entries:updatedEntries,charges:updatedCharges,invoices:[...(appData.invoices||[]),snapshot]};if(closeJobOnFinalize&&invoiceData.job){const updatedJobs=(appData.jobs||[]).map(j=>j.id===invoiceData.job.id?_objectSpread(_objectSpread({},j),{},{closed:true,closedAt:Date.now()}):j);patch.jobs=updatedJobs;}updateAppData(patch);setFinalized(true);};// Export invoice as CSV\nconst exportCSV=()=>{if(!invoiceData)return;const headers=['Date','Task','Notes','Hours','Rate','Amount'];const rows=selectedLineItems.map(item=>[item.date,item.task,item.notes,item.hours.toFixed(2),item.rate.toFixed(2),item.amount.toFixed(2)]);// Add totals row\nrows.push(['','','TOTAL',computedTotals.hours.toFixed(2),'',computedTotals.amount.toFixed(2)]);const csvContent=[headers,...rows].map(row=>row.map(cell=>\"\\\"\".concat(cell,\"\\\"\")).join(',')).join('\\n');const blob=new Blob([csvContent],{type:'text/csv'});const url=URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;link.download=\"invoice-\".concat(invoiceData.client.name,\"-\").concat(invoiceData.dateRange.start,\"-to-\").concat(invoiceData.dateRange.end,\".csv\");link.click();URL.revokeObjectURL(url);};// Print invoice\nconst printInvoice=()=>{if(!invoiceData)return;const printWindow=window.open('','_blank');const printContent=generatePrintHTML(_objectSpread(_objectSpread({},invoiceData),{},{lineItems:selectedLineItems,totals:computedTotals}));printWindow.document.write(printContent);printWindow.document.close();printWindow.focus();printWindow.print();};// Generate HTML for printing\nconst generatePrintHTML=invoice=>{return\"\\n<!DOCTYPE html>\\n<html>\\n<head>\\n    <title>Invoice - \".concat(invoice.client.name,\"</title>\\n    <style>\\n        body { font-family: Arial, sans-serif; margin: 40px; color: #333; }\\n        .header { text-align: center; margin-bottom: 40px; }\\n        .invoice-title { font-size: 28px; font-weight: bold; color: #2563eb; }\\n        .invoice-info { display: flex; justify-content: space-between; margin-bottom: 30px; }\\n        .client-info h3, .invoice-details h3 { margin-top: 0; color: #374151; }\\n        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }\\n        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }\\n        th { background-color: #f9fafb; font-weight: bold; }\\n        .amount { text-align: right; }\\n        .totals { font-weight: bold; background-color: #f3f4f6; }\\n        .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 14px; }\\n        @media print {\\n            body { margin: 20px; }\\n            .no-print { display: none; }\\n        }\\n    </style>\\n</head>\\n<body>\\n    <div class=\\\"header\\\">\\n        <div class=\\\"invoice-title\\\">INVOICE</div>\\n        <div style=\\\"margin-top: 10px; color: #6b7280;\\\">Mechanic Hours Time Tracking</div>\\n    </div>\\n    \\n    <div class=\\\"invoice-info\\\">\\n        <div class=\\\"client-info\\\">\\n            <h3>Bill To:</h3>\\n            <div><strong>\").concat(invoice.client.name,\"</strong></div>\\n            \").concat(invoice.client.contact?\"<div>\".concat(invoice.client.contact,\"</div>\"):'',\"\\n        </div>\\n        \\n        <div class=\\\"invoice-details\\\">\\n            <h3>Invoice Details:</h3>\\n            <div><strong>Invoice #:</strong> \").concat(invoice.invoiceNumber,\"</div>\\n            <div><strong>Date:</strong> \").concat(invoice.generatedDate,\"</div>\\n            <div><strong>Period:</strong> \").concat(invoice.dateRange.start,\" - \").concat(invoice.dateRange.end,\"</div>\\n        </div>\\n    </div>\\n    \\n    <table>\\n        <thead>\\n            <tr>\\n                <th>Date</th>\\n                <th>Task</th>\\n                <th>Notes</th>\\n                <th>Hours</th>\\n                <th>Rate</th>\\n                <th class=\\\"amount\\\">Amount</th>\\n            </tr>\\n        </thead>\\n        <tbody>\\n            \").concat(invoice.lineItems.map(item=>\"\\n                <tr>\\n                    <td>\".concat(item.date,\"</td>\\n                    <td>\").concat(item.task,\"</td>\\n                    <td>\").concat(item.notes,\"</td>\\n                    <td>\").concat(item.hours.toFixed(2),\"</td>\\n                    <td>\").concat(dataService.formatCurrency(item.rate),\"</td>\\n                    <td class=\\\"amount\\\">\").concat(dataService.formatCurrency(item.amount),\"</td>\\n                </tr>\\n            \")).join(''),\"\\n      <tr class=\\\"totals\\\">\\n        <td colspan=\\\"3\\\">TOTAL</td>\\n        <td><strong>\").concat(invoice.totals.hours.toFixed(2),\"</strong></td>\\n        <td></td>\\n        <td class=\\\"amount\\\"><strong>\").concat(dataService.formatCurrency(invoice.totals.amount),\"</strong></td>\\n      </tr>\\n        </tbody>\\n    </table>\\n    \\n    <div class=\\\"footer\\\">\\n        <p>Generated by Mechanic Hours - www.context7.com</p>\\n        <p>Thank you for your business!</p>\\n    </div>\\n</body>\\n</html>\\n    \");};// Clear invoice\nconst clearInvoice=()=>{setInvoiceData(null);setSelectedClient('');setStartDate('');setEndDate('');setSelectedIds(new Set());setFinalized(false);setSelectedJobId('');setMode('client');setCloseJobOnFinalize(false);clearInvoiceContext&&clearInvoiceContext();};// Set quick date ranges\nconst setThisWeek=()=>{const now=new Date();const startOfWeek=new Date(now);startOfWeek.setDate(now.getDate()-now.getDay());// Start of week (Sunday)\nsetStartDate(startOfWeek.toISOString().slice(0,10));setEndDate(now.toISOString().slice(0,10));};const setThisMonth=()=>{const now=new Date();const startOfMonth=new Date(now.getFullYear(),now.getMonth(),1);setStartDate(startOfMonth.toISOString().slice(0,10));setEndDate(now.toISOString().slice(0,10));};const setLastMonth=()=>{const now=new Date();const startOfLastMonth=new Date(now.getFullYear(),now.getMonth()-1,1);const endOfLastMonth=new Date(now.getFullYear(),now.getMonth(),0);setStartDate(startOfLastMonth.toISOString().slice(0,10));setEndDate(endOfLastMonth.toISOString().slice(0,10));};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[!invoiceData?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Generate Invoice\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mb-3\",children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:mode==='client'?'primary':'secondary',onClick:()=>setMode('client'),\"aria-label\":\"Invoice by client\",children:\"By Client\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:mode==='job'?'primary':'secondary',onClick:()=>setMode('job'),\"aria-label\":\"Invoice by job\",children:\"By Job\"})]}),/*#__PURE__*/_jsx(Select,{label:\"Client\",value:selectedClient,onChange:e=>{setSelectedClient(e.target.value);if(mode==='job')setSelectedJobId('');},options:clientOptions,placeholder:\"Select a client\"}),mode==='job'&&selectedClient&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"input-label\",children:\"Job\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"select\",value:selectedJobId,onChange:e=>setSelectedJobId(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Select Job --\"}),(appData.jobs||[]).filter(j=>!j.closed).filter(j=>{const hasBillableEntries=(appData.entries||[]).some(e=>e.jobId===j.id&&e.clientId===selectedClient&&e.end&&!e.invoiced);const hasBillableCharges=(appData.charges||[]).some(c=>c.jobId===j.id&&c.clientId===selectedClient&&!c.invoiced);return hasBillableEntries||hasBillableCharges;}).sort((a,b)=>a.name.localeCompare(b.name)).map(j=>/*#__PURE__*/_jsx(\"option\",{value:j.id,children:j.name},j.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-3\",children:[/*#__PURE__*/_jsx(Input,{label:\"Start Date\",type:\"date\",value:startDate,onChange:e=>setStartDate(e.target.value)}),/*#__PURE__*/_jsx(Input,{label:\"End Date\",type:\"date\",value:endDate,onChange:e=>setEndDate(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2 mb-4\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",size:\"small\",onClick:setThisWeek,\"aria-label\":\"Set date range to this week\",children:\"This Week\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",size:\"small\",onClick:setThisMonth,\"aria-label\":\"Set date range to this month\",children:\"This Month\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",size:\"small\",onClick:setLastMonth,\"aria-label\":\"Set date range to last month\",children:\"Last Month\"})]}),/*#__PURE__*/_jsxs(Button,{onClick:generateInvoice,className:\"w-full\",disabled:!selectedClient||!startDate||!endDate||mode==='job'&&!selectedJobId,children:[\"\\uD83D\\uDCC4 Generate \",mode==='job'?'Job':'Client',\" Invoice\"]})]}),appData.clients.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Quick Stats\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-primary-600\",children:appData.clients.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Active Clients\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:appData.entries.filter(e=>e.end).length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Completed Entries\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:[dataService.calculateTotalHours(appData.entries.filter(e=>e.end)).toFixed(1),\"h\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Total Hours\"})]})]})]}),appData.invoices&&appData.invoices.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-3\",children:\"Invoice History\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2 max-h-56 overflow-y-auto\",children:appData.invoices.slice().sort((a,b)=>b.generatedAt-a.generatedAt).map(inv=>{const client=appData.clients.find(c=>c.id===inv.clientId);return/*#__PURE__*/_jsx(\"div\",{className:\"individual-job-card\",style:{marginBottom:0},children:/*#__PURE__*/_jsx(\"div\",{className:\"job-card-content\",style:{alignItems:'center'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"job-main-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"job-title\",children:inv.invoiceNumber}),/*#__PURE__*/_jsxs(\"div\",{className:\"schedule-compact-row\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"job-time\",children:[inv.dateRange.start,\" \\u2192 \",inv.dateRange.end]}),/*#__PURE__*/_jsx(\"span\",{className:\"schedule-meta-divider\",children:\"\\u2022\"}),/*#__PURE__*/_jsx(\"span\",{className:\"job-client\",children:(client===null||client===void 0?void 0:client.name)||'Unknown Client'}),/*#__PURE__*/_jsx(\"span\",{className:\"schedule-meta-divider\",children:\"\\u2022\"}),/*#__PURE__*/_jsx(\"span\",{className:\"job-time\",children:dataService.formatCurrency(inv.total)})]})]})})},inv.id);})})]})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold\",children:\"Invoice\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[invoiceData.invoiceNumber,!finalized&&' (Draft)',\" \",invoiceData.job&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-1 px-1 rounded bg-blue-600 text-white text-xs\",children:[\"Job: \",invoiceData.job.name]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500\",children:[invoiceData.dateRange.start,\" - \",invoiceData.dateRange.end]})]}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",size:\"small\",onClick:clearInvoice,children:\"Back\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:invoiceData.client.name}),invoiceData.client.contact&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-400\",children:invoiceData.client.contact})]}),!finalized&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2 mb-3\",children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"secondary\",onClick:selectAll,\"aria-label\":\"Select all line items\",children:\"Select All\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"secondary\",onClick:clearAll,\"aria-label\":\"Clear all line items\",children:\"Clear All\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:finalizeInvoice,disabled:selectedIds.size===0,\"aria-label\":\"Finalize invoice and mark entries invoiced\",children:\"Finalize & Mark Invoiced\"}),invoiceData.job&&/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center gap-1 text-xs text-gray-400 ml-auto\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:closeJobOnFinalize,onChange:()=>setCloseJobOnFinalize(v=>!v)}),\" Close Job\"]})]}),finalized&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2 text-xs text-green-600 font-medium\",children:[\"Finalized \\u2022 \",selectedIds.size,\" items marked invoiced\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"activity-list\",children:invoiceData.lineItems.map(item=>{const checked=selectedIds.has(item.id);const disabled=finalized;return/*#__PURE__*/_jsxs(\"div\",{className:\"individual-job-card \".concat(!checked?'opacity-50':''),style:{position:'relative'},children:[!finalized&&/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:checked,onChange:()=>toggleLineItem(item.id),style:{position:'absolute',top:6,left:6,width:16,height:16},disabled:disabled,title:\"Include in invoice\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"job-card-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"job-main-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"job-title\",children:item.task}),item.kind==='charge'?/*#__PURE__*/_jsxs(\"div\",{className:\"job-time\",children:[item.date,\" \\u2022 \",item.quantity,\" x \",dataService.formatCurrency(item.rate)]}):/*#__PURE__*/_jsxs(\"div\",{className:\"job-time\",children:[item.date,\" \\u2022 \",item.hours.toFixed(2),\"h @ \",dataService.formatCurrency(item.rate)]}),item.notes&&/*#__PURE__*/_jsx(\"div\",{className:\"job-notes\",children:item.notes})]}),/*#__PURE__*/_jsx(\"div\",{className:\"job-actions\",style:{alignItems:'flex-end'},children:/*#__PURE__*/_jsx(\"div\",{className:\"stat-value stat-value-success\",style:{fontSize:'0.85rem'},children:dataService.formatCurrency(item.amount)})})]})]},item.id);})}),/*#__PURE__*/_jsx(\"div\",{className:\"separator\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm font-semibold\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total Hours\"}),/*#__PURE__*/_jsxs(\"span\",{children:[computedTotals.hours.toFixed(2),\"h\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm font-semibold mt-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total Amount\"}),/*#__PURE__*/_jsx(\"span\",{children:dataService.formatCurrency(computedTotals.amount)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-4\",children:[/*#__PURE__*/_jsx(Button,{onClick:printInvoice,className:\"flex-1\",size:\"small\",\"aria-label\":\"Print invoice\",children:\"Print\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:exportCSV,className:\"flex-1\",size:\"small\",\"aria-label\":\"Export invoice CSV\",children:\"CSV\"})]})]})}),appData.entries.filter(e=>e.end).length===0&&/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-6 text-gray-600\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"mb-2\",children:\"No completed time entries found.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Start tracking time to generate invoices!\"})]})})]});};export default InvoiceTab;","map":{"version":3,"names":["React","useState","useMemo","Card","Button","Input","Select","dataService","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","InvoiceTab","_ref","appData","updateAppData","invoiceContext","clearInvoiceContext","selectedClient","setSelectedClient","startDate","setStartDate","endDate","setEndDate","invoiceData","setInvoiceData","selectedIds","setSelectedIds","Set","finalized","setFinalized","mode","setMode","jobId","selectedJobId","setSelectedJobId","closeJobOnFinalize","setCloseJobOnFinalize","clientOptions","clients","map","client","value","id","label","name","generateInvoice","alert","find","c","start","Date","end","setHours","clientEntries","entries","filter","entry","clientId","invoiced","entryDate","clientCharges","charges","ch","chDate","createdAt","length","timeLineItems","taskName","duration","hours","durationToHours","amount","rate","date","formatDate","task","notes","chargeLineItems","kind","chargeType","description","unitPrice","quantity","unitCost","amountCached","lineItems","jobMeta","jobs","j","invoice","dateRange","job","generatedDate","invoiceNumber","concat","now","li","toggleLineItem","prev","next","has","delete","add","selectAll","clearAll","selectedLineItems","computedTotals","reduce","s","i","finalizeInvoice","_invoiceData$job","size","updatedEntries","e","_objectSpread","updatedCharges","snapshot","generateId","generatedAt","subtotal","total","patch","invoices","updatedJobs","closed","closedAt","exportCSV","headers","rows","item","toFixed","push","csvContent","row","cell","join","blob","Blob","type","url","URL","createObjectURL","link","document","createElement","href","download","click","revokeObjectURL","printInvoice","printWindow","window","open","printContent","generatePrintHTML","totals","write","close","focus","print","contact","formatCurrency","clearInvoice","setThisWeek","startOfWeek","setDate","getDate","getDay","toISOString","slice","setThisMonth","startOfMonth","getFullYear","getMonth","setLastMonth","startOfLastMonth","endOfLastMonth","className","children","variant","onClick","onChange","target","options","placeholder","hasBillableEntries","some","hasBillableCharges","sort","a","b","localeCompare","disabled","calculateTotalHours","inv","style","marginBottom","alignItems","checked","v","position","top","left","width","height","title","fontSize"],"sources":["C:/Users/jurgl/HTMLProjects/CrickTime/src/components/tabs/InvoiceTab.js"],"sourcesContent":["import React, { useState, useMemo } from 'react';\r\nimport Card from '../ui/Card';\r\nimport Button from '../ui/Button';\r\nimport Input from '../ui/Input';\r\nimport Select from '../ui/Select';\r\nimport { dataService } from '../../utils/dataService';\r\n\r\n/**\r\n * Invoice Tab Component\r\n * Reference: www.context7.com for invoice generation patterns\r\n */\r\nconst InvoiceTab = ({ appData, updateAppData, invoiceContext, clearInvoiceContext }) => {\r\n  const [selectedClient, setSelectedClient] = useState('');\r\n  const [startDate, setStartDate] = useState('');\r\n  const [endDate, setEndDate] = useState('');\r\n  const [invoiceData, setInvoiceData] = useState(null); // holds draft or finalized invoice meta & all candidate line items\r\n  const [selectedIds, setSelectedIds] = useState(new Set());\r\n  const [finalized, setFinalized] = useState(false);\r\n  const [mode, setMode] = useState(invoiceContext?.jobId ? 'job' : 'client'); // 'client' | 'job'\r\n  const [selectedJobId, setSelectedJobId] = useState(invoiceContext?.jobId || '');\r\n  const [closeJobOnFinalize, setCloseJobOnFinalize] = useState(false);\r\n\r\n  // Get client options\r\n  const clientOptions = appData.clients.map(client => ({\r\n    value: client.id,\r\n    label: client.name\r\n  }));\r\n\r\n  // Generate draft invoice data (does NOT mark entries/charges invoiced yet)\r\n  const generateInvoice = () => {\r\n    if (!selectedClient || !startDate || !endDate) {\r\n      alert('Please select a client and date range');\r\n      return;\r\n    }\r\n\r\n    if (mode === 'job' && !selectedJobId) {\r\n      alert('Select a job for Job mode');\r\n      return;\r\n    }\r\n\r\n    const client = appData.clients.find(c => c.id === selectedClient);\r\n    if (!client) {\r\n      alert('Selected client not found');\r\n      return;\r\n    }\r\n\r\n    const start = new Date(startDate);\r\n    const end = new Date(endDate);\r\n    end.setHours(23, 59, 59, 999); // Include full end date\r\n\r\n    if (start > end) {\r\n      alert('Start date must be before end date');\r\n      return;\r\n    }\r\n\r\n    // Get entries for the client and date range\r\n    const clientEntries = appData.entries.filter(entry => {\r\n      if (!entry.end || entry.clientId !== selectedClient) return false;\r\n      if (entry.invoiced) return false; // skip already invoiced\r\n      if (mode === 'job' && entry.jobId !== selectedJobId) return false;\r\n      \r\n      const entryDate = new Date(entry.start);\r\n      return entryDate >= start && entryDate <= end;\r\n    });\r\n\r\n    // Get charges for client within date range\r\n    const clientCharges = (appData.charges||[]).filter(ch => {\r\n      if (ch.invoiced) return false;\r\n      if (ch.clientId !== selectedClient) return false;\r\n      if (mode === 'job' && ch.jobId !== selectedJobId) return false;\r\n      const chDate = new Date(ch.createdAt);\r\n      return chDate >= start && chDate <= end;\r\n    });\r\n\r\n    if (clientEntries.length === 0 && clientCharges.length === 0) {\r\n      alert('No billable entries or charges found for the selected criteria');\r\n      return;\r\n    }\r\n\r\n  // Create candidate line items (all initially selected)\r\n  const timeLineItems = clientEntries.map(entry => {\r\n      const taskName = entry.taskName || 'Unknown Task';\r\n      const duration = entry.end - entry.start;\r\n      const hours = dataService.durationToHours(duration);\r\n      const amount = hours * client.rate;\r\n\r\n      return {\r\n        id: entry.id,\r\n        date: dataService.formatDate(entry.start),\r\n        task: taskName,\r\n        notes: entry.notes || '',\r\n        hours: hours,\r\n        rate: client.rate,\r\n        amount: amount\r\n      };\r\n    });\r\n\r\n    const chargeLineItems = clientCharges.map(ch => ({\r\n      id: ch.id,\r\n      kind: 'charge',\r\n      chargeType: ch.kind,\r\n      date: dataService.formatDate(ch.createdAt),\r\n      task: ch.description,\r\n      notes: '',\r\n      hours: 0,\r\n  rate: ch.unitPrice,\r\n      quantity: ch.quantity,\r\n  unitCost: ch.unitCost,\r\n      amount: ch.amountCached\r\n    }));\r\n\r\n    const lineItems = [...timeLineItems, ...chargeLineItems];\r\n\r\n    const jobMeta = mode === 'job' ? (appData.jobs || []).find(j => j.id === selectedJobId) : null;\r\n    const invoice = {\r\n      client,\r\n      dateRange: {\r\n        start: dataService.formatDate(start),\r\n        end: dataService.formatDate(end)\r\n      },\r\n      lineItems,\r\n      job: jobMeta ? { id: jobMeta.id, name: jobMeta.name } : null,\r\n      generatedDate: dataService.formatDate(new Date()),\r\n      invoiceNumber: `INV-${Date.now()}`\r\n    };\r\n\r\n    setInvoiceData(invoice);\r\n  setSelectedIds(new Set(lineItems.map(li => li.id)));\r\n    setFinalized(false);\r\n  };\r\n\r\n  // Toggle selection of a line item\r\n  const toggleLineItem = (id) => {\r\n    if (finalized) return;\r\n    setSelectedIds(prev => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) next.delete(id); else next.add(id);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const selectAll = () => {\r\n    if (!invoiceData || finalized) return;\r\n    setSelectedIds(new Set(invoiceData.lineItems.map(li => li.id)));\r\n  };\r\n\r\n  const clearAll = () => {\r\n    if (finalized) return;\r\n    setSelectedIds(new Set());\r\n  };\r\n\r\n  // Compute totals from selected items\r\n  const selectedLineItems = useMemo(() => {\r\n    if (!invoiceData) return [];\r\n    return invoiceData.lineItems.filter(li => selectedIds.has(li.id));\r\n  }, [invoiceData, selectedIds]);\r\n\r\n  const computedTotals = useMemo(() => {\r\n    const hours = selectedLineItems.reduce((s, i) => s + i.hours, 0);\r\n    const amount = selectedLineItems.reduce((s, i) => s + i.amount, 0);\r\n    return { hours, amount };\r\n  }, [selectedLineItems]);\r\n\r\n  // Finalize invoice: mark selected entries as invoiced & persist snapshot history\r\n  const finalizeInvoice = () => {\r\n    if (!invoiceData) return;\r\n    if (selectedIds.size === 0) {\r\n      alert('Select at least one line item to finalize the invoice.');\r\n      return;\r\n    }\r\n  const updatedEntries = appData.entries.map(e => selectedIds.has(e.id) ? { ...e, invoiced: true } : e);\r\n  const updatedCharges = (appData.charges||[]).map(c => selectedIds.has(c.id) ? { ...c, invoiced: true } : c);\r\n    const snapshot = {\r\n      id: dataService.generateId(),\r\n      invoiceNumber: invoiceData.invoiceNumber,\r\n      clientId: invoiceData.client.id,\r\n      jobId: invoiceData.job?.id || null,\r\n      dateRange: invoiceData.dateRange,\r\n      generatedAt: Date.now(),\r\n      lineItems: selectedLineItems.map(li => ({\r\n        id: li.id,\r\n  kind: li.kind || 'time',\r\n  chargeType: li.chargeType,\r\n        date: li.date,\r\n        task: li.task,\r\n        notes: li.notes,\r\n        hours: li.hours,\r\n        rate: li.rate,\r\n  quantity: li.quantity,\r\n  unitCost: li.unitCost,\r\n        amount: li.amount\r\n      })),\r\n      subtotal: computedTotals.amount,\r\n      total: computedTotals.amount\r\n    };\r\n  let patch = { entries: updatedEntries, charges: updatedCharges, invoices: [...(appData.invoices||[]), snapshot] };\r\n    if (closeJobOnFinalize && invoiceData.job) {\r\n      const updatedJobs = (appData.jobs || []).map(j => j.id === invoiceData.job.id ? { ...j, closed: true, closedAt: Date.now() } : j);\r\n      patch.jobs = updatedJobs;\r\n    }\r\n    updateAppData(patch);\r\n    setFinalized(true);\r\n  };\r\n\r\n  // Export invoice as CSV\r\n  const exportCSV = () => {\r\n    if (!invoiceData) return;\r\n\r\n    const headers = ['Date', 'Task', 'Notes', 'Hours', 'Rate', 'Amount'];\r\n    const rows = selectedLineItems.map(item => [\r\n      item.date,\r\n      item.task,\r\n      item.notes,\r\n      item.hours.toFixed(2),\r\n      item.rate.toFixed(2),\r\n      item.amount.toFixed(2)\r\n    ]);\r\n\r\n    // Add totals row\r\n    rows.push(['', '', 'TOTAL', computedTotals.hours.toFixed(2), '', computedTotals.amount.toFixed(2)]);\r\n\r\n    const csvContent = [headers, ...rows]\r\n      .map(row => row.map(cell => `\"${cell}\"`).join(','))\r\n      .join('\\n');\r\n\r\n    const blob = new Blob([csvContent], { type: 'text/csv' });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `invoice-${invoiceData.client.name}-${invoiceData.dateRange.start}-to-${invoiceData.dateRange.end}.csv`;\r\n    link.click();\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  // Print invoice\r\n  const printInvoice = () => {\r\n    if (!invoiceData) return;\r\n\r\n    const printWindow = window.open('', '_blank');\r\n    const printContent = generatePrintHTML({ ...invoiceData, lineItems: selectedLineItems, totals: computedTotals });\r\n    \r\n    printWindow.document.write(printContent);\r\n    printWindow.document.close();\r\n    printWindow.focus();\r\n    printWindow.print();\r\n  };\r\n\r\n  // Generate HTML for printing\r\n  const generatePrintHTML = (invoice) => {\r\n    return `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>Invoice - ${invoice.client.name}</title>\r\n    <style>\r\n        body { font-family: Arial, sans-serif; margin: 40px; color: #333; }\r\n        .header { text-align: center; margin-bottom: 40px; }\r\n        .invoice-title { font-size: 28px; font-weight: bold; color: #2563eb; }\r\n        .invoice-info { display: flex; justify-content: space-between; margin-bottom: 30px; }\r\n        .client-info h3, .invoice-details h3 { margin-top: 0; color: #374151; }\r\n        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }\r\n        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }\r\n        th { background-color: #f9fafb; font-weight: bold; }\r\n        .amount { text-align: right; }\r\n        .totals { font-weight: bold; background-color: #f3f4f6; }\r\n        .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 14px; }\r\n        @media print {\r\n            body { margin: 20px; }\r\n            .no-print { display: none; }\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <div class=\"invoice-title\">INVOICE</div>\r\n        <div style=\"margin-top: 10px; color: #6b7280;\">Mechanic Hours Time Tracking</div>\r\n    </div>\r\n    \r\n    <div class=\"invoice-info\">\r\n        <div class=\"client-info\">\r\n            <h3>Bill To:</h3>\r\n            <div><strong>${invoice.client.name}</strong></div>\r\n            ${invoice.client.contact ? `<div>${invoice.client.contact}</div>` : ''}\r\n        </div>\r\n        \r\n        <div class=\"invoice-details\">\r\n            <h3>Invoice Details:</h3>\r\n            <div><strong>Invoice #:</strong> ${invoice.invoiceNumber}</div>\r\n            <div><strong>Date:</strong> ${invoice.generatedDate}</div>\r\n            <div><strong>Period:</strong> ${invoice.dateRange.start} - ${invoice.dateRange.end}</div>\r\n        </div>\r\n    </div>\r\n    \r\n    <table>\r\n        <thead>\r\n            <tr>\r\n                <th>Date</th>\r\n                <th>Task</th>\r\n                <th>Notes</th>\r\n                <th>Hours</th>\r\n                <th>Rate</th>\r\n                <th class=\"amount\">Amount</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            ${invoice.lineItems.map(item => `\r\n                <tr>\r\n                    <td>${item.date}</td>\r\n                    <td>${item.task}</td>\r\n                    <td>${item.notes}</td>\r\n                    <td>${item.hours.toFixed(2)}</td>\r\n                    <td>${dataService.formatCurrency(item.rate)}</td>\r\n                    <td class=\"amount\">${dataService.formatCurrency(item.amount)}</td>\r\n                </tr>\r\n            `).join('')}\r\n      <tr class=\"totals\">\r\n        <td colspan=\"3\">TOTAL</td>\r\n        <td><strong>${invoice.totals.hours.toFixed(2)}</strong></td>\r\n        <td></td>\r\n        <td class=\"amount\"><strong>${dataService.formatCurrency(invoice.totals.amount)}</strong></td>\r\n      </tr>\r\n        </tbody>\r\n    </table>\r\n    \r\n    <div class=\"footer\">\r\n        <p>Generated by Mechanic Hours - www.context7.com</p>\r\n        <p>Thank you for your business!</p>\r\n    </div>\r\n</body>\r\n</html>\r\n    `;\r\n  };\r\n\r\n  // Clear invoice\r\n  const clearInvoice = () => {\r\n    setInvoiceData(null);\r\n    setSelectedClient('');\r\n    setStartDate('');\r\n    setEndDate('');\r\n    setSelectedIds(new Set());\r\n    setFinalized(false);\r\n    setSelectedJobId('');\r\n    setMode('client');\r\n    setCloseJobOnFinalize(false);\r\n    clearInvoiceContext && clearInvoiceContext();\r\n  };\r\n\r\n  // Set quick date ranges\r\n  const setThisWeek = () => {\r\n    const now = new Date();\r\n    const startOfWeek = new Date(now);\r\n    startOfWeek.setDate(now.getDate() - now.getDay()); // Start of week (Sunday)\r\n    \r\n    setStartDate(startOfWeek.toISOString().slice(0, 10));\r\n    setEndDate(now.toISOString().slice(0, 10));\r\n  };\r\n\r\n  const setThisMonth = () => {\r\n    const now = new Date();\r\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    \r\n    setStartDate(startOfMonth.toISOString().slice(0, 10));\r\n    setEndDate(now.toISOString().slice(0, 10));\r\n  };\r\n\r\n  const setLastMonth = () => {\r\n    const now = new Date();\r\n    const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n    const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0);\r\n    \r\n    setStartDate(startOfLastMonth.toISOString().slice(0, 10));\r\n    setEndDate(endOfLastMonth.toISOString().slice(0, 10));\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n  {!invoiceData ? (\r\n        <>\r\n          {/* Invoice Generation Form */}\r\n          <Card>\r\n            <h2 className=\"text-xl font-bold mb-4\">Generate Invoice</h2>\r\n\r\n            <div className=\"flex gap-2 mb-3\">\r\n              <Button size=\"small\" variant={mode==='client'?'primary':'secondary'} onClick={()=>setMode('client')} aria-label=\"Invoice by client\">By Client</Button>\r\n              <Button size=\"small\" variant={mode==='job'?'primary':'secondary'} onClick={()=>setMode('job')} aria-label=\"Invoice by job\">By Job</Button>\r\n            </div>\r\n            \r\n            <Select\r\n              label=\"Client\"\r\n              value={selectedClient}\r\n              onChange={(e) => { setSelectedClient(e.target.value); if(mode==='job') setSelectedJobId(''); }}\r\n              options={clientOptions}\r\n              placeholder=\"Select a client\"\r\n            />\r\n\r\n      {mode === 'job' && selectedClient && (\r\n              <div className=\"mb-3\">\r\n                <label className=\"input-label\">Job</label>\r\n                <select\r\n                  className=\"select\"\r\n                  value={selectedJobId}\r\n                  onChange={(e)=>setSelectedJobId(e.target.value)}\r\n                >\r\n                  <option value=\"\">-- Select Job --</option>\r\n                  {(appData.jobs||[])\r\n                    .filter(j=>!j.closed)\r\n        .filter(j=> {\r\n          const hasBillableEntries = (appData.entries||[]).some(e=>e.jobId===j.id && e.clientId===selectedClient && e.end && !e.invoiced);\r\n          const hasBillableCharges = (appData.charges||[]).some(c=>c.jobId===j.id && c.clientId===selectedClient && !c.invoiced);\r\n          return hasBillableEntries || hasBillableCharges;\r\n        })\r\n                    .sort((a,b)=>a.name.localeCompare(b.name))\r\n                    .map(j => <option key={j.id} value={j.id}>{j.name}</option>)}\r\n                </select>\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n              <Input\r\n                label=\"Start Date\"\r\n                type=\"date\"\r\n                value={startDate}\r\n                onChange={(e) => setStartDate(e.target.value)}\r\n              />\r\n              \r\n              <Input\r\n                label=\"End Date\"\r\n                type=\"date\"\r\n                value={endDate}\r\n                onChange={(e) => setEndDate(e.target.value)}\r\n              />\r\n            </div>\r\n            \r\n            {/* Quick Date Buttons */}\r\n            <div className=\"flex flex-wrap gap-2 mb-4\">\r\n              <Button variant=\"secondary\" size=\"small\" onClick={setThisWeek} aria-label=\"Set date range to this week\">\r\n                This Week\r\n              </Button>\r\n              <Button variant=\"secondary\" size=\"small\" onClick={setThisMonth} aria-label=\"Set date range to this month\">\r\n                This Month\r\n              </Button>\r\n              <Button variant=\"secondary\" size=\"small\" onClick={setLastMonth} aria-label=\"Set date range to last month\">\r\n                Last Month\r\n              </Button>\r\n            </div>\r\n            \r\n            <Button \r\n              onClick={generateInvoice}\r\n              className=\"w-full\"\r\n              disabled={!selectedClient || !startDate || !endDate || (mode==='job' && !selectedJobId)}\r\n            >\r\n              ðŸ“„ Generate {mode==='job' ? 'Job' : 'Client'} Invoice\r\n            </Button>\r\n          </Card>\r\n\r\n          {/* Summary Statistics */}\r\n          {appData.clients.length > 0 && (\r\n            <Card>\r\n              <h3 className=\"text-lg font-semibold mb-4\">Quick Stats</h3>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-center\">\r\n                <div>\r\n                  <div className=\"text-2xl font-bold text-primary-600\">\r\n                    {appData.clients.length}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600\">Active Clients</div>\r\n                </div>\r\n                <div>\r\n                  <div className=\"text-2xl font-bold text-green-600\">\r\n                    {appData.entries.filter(e => e.end).length}\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600\">Completed Entries</div>\r\n                </div>\r\n                <div>\r\n                  <div className=\"text-2xl font-bold text-blue-600\">\r\n                    {dataService.calculateTotalHours(appData.entries.filter(e => e.end)).toFixed(1)}h\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600\">Total Hours</div>\r\n                </div>\r\n              </div>\r\n            </Card>\r\n          )}\r\n          {/* Invoice History Stub */}\r\n          { (appData.invoices && appData.invoices.length > 0) && (\r\n            <Card>\r\n              <h3 className=\"text-lg font-semibold mb-3\">Invoice History</h3>\r\n              <div className=\"space-y-2 max-h-56 overflow-y-auto\">\r\n                {appData.invoices.slice().sort((a,b)=>b.generatedAt - a.generatedAt).map(inv => {\r\n                  const client = appData.clients.find(c=>c.id===inv.clientId);\r\n                  return (\r\n                    <div key={inv.id} className=\"individual-job-card\" style={{marginBottom:0}}>\r\n                      <div className=\"job-card-content\" style={{alignItems:'center'}}>\r\n                        <div className=\"job-main-info\">\r\n                          <div className=\"job-title\">{inv.invoiceNumber}</div>\r\n                          <div className=\"schedule-compact-row\">\r\n                            <span className=\"job-time\">{inv.dateRange.start} â†’ {inv.dateRange.end}</span>\r\n                            <span className=\"schedule-meta-divider\">â€¢</span>\r\n                            <span className=\"job-client\">{client?.name || 'Unknown Client'}</span>\r\n                            <span className=\"schedule-meta-divider\">â€¢</span>\r\n                            <span className=\"job-time\">{dataService.formatCurrency(inv.total)}</span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </Card>\r\n          )}\r\n        </>\r\n      ) : (\r\n        <>\r\n          <Card>\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div>\r\n                <h2 className=\"text-xl font-bold\">Invoice</h2>\r\n                <p className=\"text-sm text-gray-500\">{invoiceData.invoiceNumber}{!finalized && ' (Draft)'} {invoiceData.job && <span className=\"ml-1 px-1 rounded bg-blue-600 text-white text-xs\">Job: {invoiceData.job.name}</span>}</p>\r\n                <p className=\"text-xs text-gray-500\">{invoiceData.dateRange.start} - {invoiceData.dateRange.end}</p>\r\n              </div>\r\n              <Button variant=\"secondary\" size=\"small\" onClick={clearInvoice}>Back</Button>\r\n            </div>\r\n            <div className=\"mb-4\">\r\n              <div className=\"font-semibold\">{invoiceData.client.name}</div>\r\n              {invoiceData.client.contact && <div className=\"text-xs text-gray-400\">{invoiceData.client.contact}</div>}\r\n            </div>\r\n\r\n            {!finalized && (\r\n              <div className=\"flex flex-wrap gap-2 mb-3\">\r\n                <Button size=\"small\" variant=\"secondary\" onClick={selectAll} aria-label=\"Select all line items\">Select All</Button>\r\n                <Button size=\"small\" variant=\"secondary\" onClick={clearAll} aria-label=\"Clear all line items\">Clear All</Button>\r\n                <Button size=\"small\" onClick={finalizeInvoice} disabled={selectedIds.size === 0} aria-label=\"Finalize invoice and mark entries invoiced\">Finalize & Mark Invoiced</Button>\r\n                {invoiceData.job && (\r\n                  <label className=\"flex items-center gap-1 text-xs text-gray-400 ml-auto\">\r\n                    <input type=\"checkbox\" checked={closeJobOnFinalize} onChange={()=>setCloseJobOnFinalize(v=>!v)} /> Close Job\r\n                  </label>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {finalized && (\r\n              <div className=\"mb-2 text-xs text-green-600 font-medium\">Finalized â€¢ {selectedIds.size} items marked invoiced</div>\r\n            )}\r\n            <div className=\"activity-list\">\r\n              {invoiceData.lineItems.map(item => {\r\n                const checked = selectedIds.has(item.id);\r\n                const disabled = finalized;\r\n                return (\r\n                <div key={item.id} className={`individual-job-card ${!checked ? 'opacity-50' : ''}`} style={{position:'relative'}}>\r\n                  {!finalized && (\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={checked}\r\n                      onChange={() => toggleLineItem(item.id)}\r\n                      style={{position:'absolute', top:6, left:6, width:16, height:16}}\r\n                      disabled={disabled}\r\n                      title=\"Include in invoice\"\r\n                    />\r\n                  )}\r\n                  <div className=\"job-card-content\">\r\n                    <div className=\"job-main-info\">\r\n                      <div className=\"job-title\">{item.task}</div>\r\n                      {item.kind === 'charge' ? (\r\n                        <div className=\"job-time\">{item.date} â€¢ {item.quantity} x {dataService.formatCurrency(item.rate)}</div>\r\n                      ) : (\r\n                        <div className=\"job-time\">{item.date} â€¢ {item.hours.toFixed(2)}h @ {dataService.formatCurrency(item.rate)}</div>\r\n                      )}\r\n                      {item.notes && <div className=\"job-notes\">{item.notes}</div>}\r\n                    </div>\r\n                    <div className=\"job-actions\" style={{alignItems:'flex-end'}}>\r\n                      <div className=\"stat-value stat-value-success\" style={{fontSize:'0.85rem'}}>{dataService.formatCurrency(item.amount)}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )})}\r\n            </div>\r\n            <div className=\"separator\" />\r\n            <div className=\"flex justify-between text-sm font-semibold\">\r\n              <span>Total Hours</span>\r\n              <span>{computedTotals.hours.toFixed(2)}h</span>\r\n            </div>\r\n            <div className=\"flex justify-between text-sm font-semibold mt-2\">\r\n              <span>Total Amount</span>\r\n              <span>{dataService.formatCurrency(computedTotals.amount)}</span>\r\n            </div>\r\n            <div className=\"flex gap-2 mt-4\">\r\n              <Button onClick={printInvoice} className=\"flex-1\" size=\"small\" aria-label=\"Print invoice\">Print</Button>\r\n              <Button variant=\"secondary\" onClick={exportCSV} className=\"flex-1\" size=\"small\" aria-label=\"Export invoice CSV\">CSV</Button>\r\n            </div>\r\n          </Card>\r\n        </>\r\n      )}\r\n      \r\n      {/* Help Text */}\r\n      {appData.entries.filter(e => e.end).length === 0 && (\r\n        <Card>\r\n          <div className=\"text-center py-6 text-gray-600\">\r\n            <p className=\"mb-2\">No completed time entries found.</p>\r\n            <p>Start tracking time to generate invoices!</p>\r\n          </div>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InvoiceTab;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}