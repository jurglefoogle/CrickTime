{"ast":null,"code":"/**\r\n * Data Service for Mechanic Hours App\r\n * Handles all data persistence and manipulation\r\n * Reference: www.context7.com for data management best practices\r\n */\n\nconst STORAGE_KEY = 'mechanicHoursData';\n\n// Default data structure\nconst DEFAULT_DATA = {\n  clients: [],\n  tasks: [],\n  entries: [],\n  active: null\n};\nexport const dataService = {\n  /**\r\n   * Load data from localStorage\r\n   * @returns {Object} Application data\r\n   */\n  loadData() {\n    try {\n      const data = localStorage.getItem(STORAGE_KEY);\n      return data ? JSON.parse(data) : DEFAULT_DATA;\n    } catch (error) {\n      console.error('Error loading data:', error);\n      return DEFAULT_DATA;\n    }\n  },\n  /**\r\n   * Save data to localStorage\r\n   * @param {Object} data - Application data to save\r\n   */\n  saveData(data) {\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n    } catch (error) {\n      console.error('Error saving data:', error);\n    }\n  },\n  /**\r\n   * Generate unique ID\r\n   * @returns {string} Unique identifier\r\n   */\n  generateId() {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\n  },\n  /**\r\n   * Format duration from milliseconds to readable string\r\n   * @param {number} duration - Duration in milliseconds\r\n   * @returns {string} Formatted duration (e.g., \"2h 30m\")\r\n   */\n  formatDuration(duration) {\n    if (!duration || duration < 0) return '0m';\n    const hours = Math.floor(duration / (1000 * 60 * 60));\n    const minutes = Math.floor(duration % (1000 * 60 * 60) / (1000 * 60));\n    if (hours === 0) {\n      return `${minutes}m`;\n    } else if (minutes === 0) {\n      return `${hours}h`;\n    } else {\n      return `${hours}h ${minutes}m`;\n    }\n  },\n  /**\r\n   * Convert duration to decimal hours for billing\r\n   * @param {number} duration - Duration in milliseconds\r\n   * @returns {number} Duration in decimal hours\r\n   */\n  durationToHours(duration) {\n    return duration / (1000 * 60 * 60);\n  },\n  /**\r\n   * Format currency amount\r\n   * @param {number} amount - Amount to format\r\n   * @returns {string} Formatted currency string\r\n   */\n  formatCurrency(amount) {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD'\n    }).format(amount);\n  },\n  /**\r\n   * Format date for display\r\n   * @param {number|Date} date - Date to format\r\n   * @returns {string} Formatted date string\r\n   */\n  formatDate(date) {\n    const dateObj = typeof date === 'number' ? new Date(date) : date;\n    return dateObj.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  },\n  /**\r\n   * Format time for display\r\n   * @param {number|Date} date - Date to format\r\n   * @returns {string} Formatted time string\r\n   */\n  formatTime(date) {\n    const dateObj = typeof date === 'number' ? new Date(date) : date;\n    return dateObj.toLocaleTimeString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  },\n  /**\r\n   * Get entries for a specific date range\r\n   * @param {Object[]} entries - All entries\r\n   * @param {Date} startDate - Start date\r\n   * @param {Date} endDate - End date\r\n   * @returns {Object[]} Filtered entries\r\n   */\n  getEntriesInRange(entries, startDate, endDate) {\n    return entries.filter(entry => {\n      const entryDate = new Date(entry.start);\n      return entryDate >= startDate && entryDate <= endDate;\n    });\n  },\n  /**\r\n   * Calculate total hours for entries\r\n   * @param {Object[]} entries - Entries to calculate\r\n   * @returns {number} Total hours\r\n   */\n  calculateTotalHours(entries) {\n    return entries.reduce((total, entry) => {\n      if (entry.end && entry.start) {\n        return total + this.durationToHours(entry.end - entry.start);\n      }\n      return total;\n    }, 0);\n  },\n  /**\r\n   * Calculate total amount for entries with client rates\r\n   * @param {Object[]} entries - Entries to calculate\r\n   * @param {Object[]} clients - Client data with rates\r\n   * @returns {number} Total amount\r\n   */\n  calculateTotalAmount(entries, clients) {\n    return entries.reduce((total, entry) => {\n      if (entry.end && entry.start) {\n        const client = clients.find(c => c.id === entry.clientId);\n        if (client && client.rate) {\n          const hours = this.durationToHours(entry.end - entry.start);\n          return total + hours * client.rate;\n        }\n      }\n      return total;\n    }, 0);\n  },\n  /**\r\n   * Export data as JSON for backup\r\n   * @param {Object} data - Application data\r\n   * @returns {string} JSON string\r\n   */\n  exportData(data) {\n    try {\n      return JSON.stringify(data, null, 2);\n    } catch (error) {\n      console.error('Error exporting data:', error);\n      return null;\n    }\n  },\n  /**\r\n   * Import data from JSON backup\r\n   * @param {string} jsonString - JSON data string\r\n   * @returns {Object|null} Parsed data or null if invalid\r\n   */\n  importData(jsonString) {\n    try {\n      const data = JSON.parse(jsonString);\n      // Validate data structure\n      if (data && typeof data === 'object' && Array.isArray(data.clients) && Array.isArray(data.tasks) && Array.isArray(data.entries)) {\n        return data;\n      }\n      return null;\n    } catch (error) {\n      console.error('Error importing data:', error);\n      return null;\n    }\n  }\n};","map":{"version":3,"names":["STORAGE_KEY","DEFAULT_DATA","clients","tasks","entries","active","dataService","loadData","data","localStorage","getItem","JSON","parse","error","console","saveData","setItem","stringify","generateId","Date","now","toString","Math","random","substr","formatDuration","duration","hours","floor","minutes","durationToHours","formatCurrency","amount","Intl","NumberFormat","style","currency","format","formatDate","date","dateObj","toLocaleDateString","year","month","day","formatTime","toLocaleTimeString","hour","minute","getEntriesInRange","startDate","endDate","filter","entry","entryDate","start","calculateTotalHours","reduce","total","end","calculateTotalAmount","client","find","c","id","clientId","rate","exportData","importData","jsonString","Array","isArray"],"sources":["C:/Users/jurgl/HTMLProjects/CrickTime/src/utils/dataService.js"],"sourcesContent":["/**\r\n * Data Service for Mechanic Hours App\r\n * Handles all data persistence and manipulation\r\n * Reference: www.context7.com for data management best practices\r\n */\r\n\r\nconst STORAGE_KEY = 'mechanicHoursData';\r\n\r\n// Default data structure\r\nconst DEFAULT_DATA = {\r\n  clients: [],\r\n  tasks: [],\r\n  entries: [],\r\n  active: null\r\n};\r\n\r\nexport const dataService = {\r\n  /**\r\n   * Load data from localStorage\r\n   * @returns {Object} Application data\r\n   */\r\n  loadData() {\r\n    try {\r\n      const data = localStorage.getItem(STORAGE_KEY);\r\n      return data ? JSON.parse(data) : DEFAULT_DATA;\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n      return DEFAULT_DATA;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Save data to localStorage\r\n   * @param {Object} data - Application data to save\r\n   */\r\n  saveData(data) {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\r\n    } catch (error) {\r\n      console.error('Error saving data:', error);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Generate unique ID\r\n   * @returns {string} Unique identifier\r\n   */\r\n  generateId() {\r\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\r\n  },\r\n\r\n  /**\r\n   * Format duration from milliseconds to readable string\r\n   * @param {number} duration - Duration in milliseconds\r\n   * @returns {string} Formatted duration (e.g., \"2h 30m\")\r\n   */\r\n  formatDuration(duration) {\r\n    if (!duration || duration < 0) return '0m';\r\n    \r\n    const hours = Math.floor(duration / (1000 * 60 * 60));\r\n    const minutes = Math.floor((duration % (1000 * 60 * 60)) / (1000 * 60));\r\n    \r\n    if (hours === 0) {\r\n      return `${minutes}m`;\r\n    } else if (minutes === 0) {\r\n      return `${hours}h`;\r\n    } else {\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Convert duration to decimal hours for billing\r\n   * @param {number} duration - Duration in milliseconds\r\n   * @returns {number} Duration in decimal hours\r\n   */\r\n  durationToHours(duration) {\r\n    return duration / (1000 * 60 * 60);\r\n  },\r\n\r\n  /**\r\n   * Format currency amount\r\n   * @param {number} amount - Amount to format\r\n   * @returns {string} Formatted currency string\r\n   */\r\n  formatCurrency(amount) {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD'\r\n    }).format(amount);\r\n  },\r\n\r\n  /**\r\n   * Format date for display\r\n   * @param {number|Date} date - Date to format\r\n   * @returns {string} Formatted date string\r\n   */\r\n  formatDate(date) {\r\n    const dateObj = typeof date === 'number' ? new Date(date) : date;\r\n    return dateObj.toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Format time for display\r\n   * @param {number|Date} date - Date to format\r\n   * @returns {string} Formatted time string\r\n   */\r\n  formatTime(date) {\r\n    const dateObj = typeof date === 'number' ? new Date(date) : date;\r\n    return dateObj.toLocaleTimeString('en-US', {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Get entries for a specific date range\r\n   * @param {Object[]} entries - All entries\r\n   * @param {Date} startDate - Start date\r\n   * @param {Date} endDate - End date\r\n   * @returns {Object[]} Filtered entries\r\n   */\r\n  getEntriesInRange(entries, startDate, endDate) {\r\n    return entries.filter(entry => {\r\n      const entryDate = new Date(entry.start);\r\n      return entryDate >= startDate && entryDate <= endDate;\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Calculate total hours for entries\r\n   * @param {Object[]} entries - Entries to calculate\r\n   * @returns {number} Total hours\r\n   */\r\n  calculateTotalHours(entries) {\r\n    return entries.reduce((total, entry) => {\r\n      if (entry.end && entry.start) {\r\n        return total + this.durationToHours(entry.end - entry.start);\r\n      }\r\n      return total;\r\n    }, 0);\r\n  },\r\n\r\n  /**\r\n   * Calculate total amount for entries with client rates\r\n   * @param {Object[]} entries - Entries to calculate\r\n   * @param {Object[]} clients - Client data with rates\r\n   * @returns {number} Total amount\r\n   */\r\n  calculateTotalAmount(entries, clients) {\r\n    return entries.reduce((total, entry) => {\r\n      if (entry.end && entry.start) {\r\n        const client = clients.find(c => c.id === entry.clientId);\r\n        if (client && client.rate) {\r\n          const hours = this.durationToHours(entry.end - entry.start);\r\n          return total + (hours * client.rate);\r\n        }\r\n      }\r\n      return total;\r\n    }, 0);\r\n  },\r\n\r\n  /**\r\n   * Export data as JSON for backup\r\n   * @param {Object} data - Application data\r\n   * @returns {string} JSON string\r\n   */\r\n  exportData(data) {\r\n    try {\r\n      return JSON.stringify(data, null, 2);\r\n    } catch (error) {\r\n      console.error('Error exporting data:', error);\r\n      return null;\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Import data from JSON backup\r\n   * @param {string} jsonString - JSON data string\r\n   * @returns {Object|null} Parsed data or null if invalid\r\n   */\r\n  importData(jsonString) {\r\n    try {\r\n      const data = JSON.parse(jsonString);\r\n      // Validate data structure\r\n      if (data && typeof data === 'object' && \r\n          Array.isArray(data.clients) && \r\n          Array.isArray(data.tasks) && \r\n          Array.isArray(data.entries)) {\r\n        return data;\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      console.error('Error importing data:', error);\r\n      return null;\r\n    }\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}